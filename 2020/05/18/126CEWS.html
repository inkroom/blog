<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="dark"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png"><link rel="icon" href="/img/fluid.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=5,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="author" content="inkbox"><meta name="keywords" content=""><meta name="description" content="随着互联网的发展，网络基础设置的改善，人们对于网络应用提出了更高的要求，于是各大互联网公司纷纷采用分布式架构以支持越来越高的并发量。由分布式架构引出来的日志问题也越来越突出。在单机环境下可以正常使用的日志解决方案在分布式环境下表现的有心无力。因此本系统的目的在于提供一个更加友好的日志采集和存储方案。本文分几部分阐述了基于Java开发，涉及消息中间件，socket短连接等技术的日志采集系统的结构和设"><meta property="og:type" content="article"><meta property="og:title" content="日志采集"><meta property="og:url" content="http://blog.inkroom.cn/2020/05/18/126CEWS.html"><meta property="og:site_name" content="墨盒"><meta property="og:description" content="随着互联网的发展，网络基础设置的改善，人们对于网络应用提出了更高的要求，于是各大互联网公司纷纷采用分布式架构以支持越来越高的并发量。由分布式架构引出来的日志问题也越来越突出。在单机环境下可以正常使用的日志解决方案在分布式环境下表现的有心无力。因此本系统的目的在于提供一个更加友好的日志采集和存储方案。本文分几部分阐述了基于Java开发，涉及消息中间件，socket短连接等技术的日志采集系统的结构和设"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://user-images.githubusercontent.com/27911304/82168048-3e1ecb80-98f0-11ea-8f64-e8592e97f03f.png"><meta property="og:image" content="https://user-images.githubusercontent.com/27911304/82168151-a53c8000-98f0-11ea-98d6-7307b519efd5.png"><meta property="og:image" content="https://user-images.githubusercontent.com/27911304/82168320-1b40e700-98f1-11ea-9cc6-952fe013ae38.png"><meta property="og:image" content="https://user-images.githubusercontent.com/27911304/82168325-209e3180-98f1-11ea-906d-1a36e6e15e95.png"><meta property="og:image" content="https://user-images.githubusercontent.com/27911304/82168332-23992200-98f1-11ea-8afd-105f03851967.png"><meta property="og:image" content="https://user-images.githubusercontent.com/27911304/82169128-10875180-98f3-11ea-8ffd-bd0d51e46702.png"><meta property="og:image" content="https://user-images.githubusercontent.com/27911304/82169134-154c0580-98f3-11ea-9b97-7683a33f216d.png"><meta property="og:image" content="https://user-images.githubusercontent.com/27911304/82169137-167d3280-98f3-11ea-8c6a-58779faeb1ea.png"><meta property="article:published_time" content="2020-05-18T00:00:00.000Z"><meta property="article:modified_time" content="2025-07-21T06:31:32.542Z"><meta property="article:author" content="inkbox"><meta property="article:tag" content="java"><meta property="article:tag" content="后端"><meta property="article:tag" content="log"><meta property="article:tag" content="日志采集"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:image" content="https://user-images.githubusercontent.com/27911304/82168048-3e1ecb80-98f0-11ea-8f64-e8592e97f03f.png"><title>日志采集 - 墨盒</title><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.6.1/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/hint.css/2.7.0/hint.min.css"><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/c/font_1749284_5i9bdhy70f8.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css"><link rel="stylesheet" href="/css/main.css"><link id="highlight-css" rel="stylesheet" href="/css/highlight.css"><link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css"><script id="fluid-configs">var Fluid=window.Fluid||{};Fluid.ctx=Object.assign({},Fluid.ctx);var CONFIG={hostname:"blog.inkroom.cn",root:"/",version:"1.9.8",typing:{enable:!0,typeSpeed:70,cursorChar:"_",loop:!1,scope:[]},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"left",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:100}},code_language:{enable:!0,default:"TEXT"},copy_btn:!0,image_caption:{enable:!0},image_zoom:{enable:!0,img_url_replace:["",""]},toc:{enable:!0,placement:"left",headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,loading_img:"/img/loading.gif",onlypost:!1,offset_factor:2},web_analytics:{enable:!1,follow_dnt:!0,baidu:null,google:{measurement_id:null},tencent:{sid:null,cid:null},leancloud:{app_id:null,app_key:null,server_url:null,path:"window.location.pathname",ignore_local:!1},umami:{src:null,website_id:null,domains:null,start_time:"2024-01-01T00:00:00.000Z",token:null,api_server:null},woyaola:null,cnzz:null},search_path:"/local-search.xml",include_content_in_search:!0};if(CONFIG.web_analytics.follow_dnt){var dntVal=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack;Fluid.ctx.dnt=dntVal&&(dntVal.startsWith("1")||dntVal.startsWith("yes")||dntVal.startsWith("on"))}</script><script src="/js/utils.js"></script><script src="/js/color-schema.js"></script><meta name="generator" content="Hexo 5.4.2"></head><body><header><div class="header-inner" style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/"><strong>Fluid</strong> </a><button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="/" target="_self"><i class="iconfont icon-home-fill"></i> <span>首页</span></a></li><li class="nav-item"><a class="nav-link" href="/archives/" target="_self"><i class="iconfont icon-archive-fill"></i> <span>归档</span></a></li><li class="nav-item"><a class="nav-link" href="/categories/" target="_self"><i class="iconfont icon-category-fill"></i> <span>分类</span></a></li><li class="nav-item"><a class="nav-link" href="/tags/" target="_self"><i class="iconfont icon-tags-fill"></i> <span>标签</span></a></li><li class="nav-item"><a class="nav-link" href="/about/" target="_self"><i class="iconfont icon-user-fill"></i> <span>关于</span></a></li><li class="nav-item" id="search-btn"><a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search"><i class="iconfont icon-search"></i></a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle"><i class="iconfont icon-dark" id="color-toggle-icon"></i></a></li></ul></div></div></nav><div id="banner" class="banner" parallax="true" style="background:url(/img/default.png) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="banner-text text-center fade-in-up"><div class="h2"><span id="subtitle" data-typed-text="日志采集"></span></div><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-05-18 00:00" pubdate>2020年5月18日 凌晨</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.6k 字</span></div></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="side-col d-none d-lg-block col-lg-2"><aside class="sidebar" style="padding-left:2rem;margin-right:-1rem"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i> <span>目录</span></p><div class="toc-body" id="toc-body"></div></div></aside></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div id="board"><article class="post-content mx-auto"><h1 id="seo-header">日志采集</h1><div class="markdown-body"><p>随着互联网的发展，网络基础设置的改善，人们对于网络应用提出了更高的要求，于是各大互联网公司纷纷采用分布式架构以支持越来越高的并发量。由分布式架构引出来的日志问题也越来越突出。在单机环境下可以正常使用的日志解决方案在分布式环境下表现的有心无力。因此本系统的目的在于提供一个更加友好的日志采集和存储方案。<br>本文分几部分阐述了基于Java开发，涉及消息中间件，socket短连接等技术的日志采集系统的结构和设计实现过程，实现了日志发送、日志存储、日志备份、日志实时浏览等功能。支持横向扩展，可以轻松实现分布式部署。同时充分考虑了宕机情况的出现，尽可能地保证系统核心功能的正常运行。<br>根据本文设计思路，最终开发出一个健壮、稳定的日志采集系统。</p><span id="more"></span><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><p>软件客户端发送日志消息到消息中间件，采集模块从消息中间件中拿取数据，存入时序数据库，并且定时备份日志文件到本地文件系统，同时利用WebSocket等技术实现日志的实时浏览。</p><h3 id="功能"><a href="#功能" class="headerlink" title="功能"></a>功能</h3><h4 id="日志发送"><a href="#日志发送" class="headerlink" title="日志发送"></a>日志发送</h4><p>软件客户端通过本系统提供的工具发送日志消息到指定的消息中间件，且在一定程度上保证有序。</p><h4 id="日志收集"><a href="#日志收集" class="headerlink" title="日志收集"></a>日志收集</h4><p>本系统通过监听消息中间件，即使拿取日志消息，并且按照一定的规则进行持久化存储。</p><h4 id="服务监控"><a href="#服务监控" class="headerlink" title="服务监控"></a>服务监控</h4><p>本系统提供Web模块以监控采集模块以及相关服务运行状况。</p><h4 id="日志备份"><a href="#日志备份" class="headerlink" title="日志备份"></a>日志备份</h4><p>本系统可以定期将日志持久化到文件，存储在本地文件系统。同时提供相应的下载接口</p><h4 id="实时日志浏览"><a href="#实时日志浏览" class="headerlink" title="实时日志浏览"></a>实时日志浏览</h4><p>本系统提供接口以实时查看消息中间件接收到的日志消息，同时支持简单的规则过滤，并保证在一定程度下日志消息有序，以便开发人员调试。</p><h4 id="宕机记录"><a href="#宕机记录" class="headerlink" title="宕机记录"></a>宕机记录</h4><p>可通过本系统查看相应日志生产者宕机情况</p><h2 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h2><p>涉及到的环境</p><ul><li>jdk1.8+</li><li>ActiveMq</li><li>Influxdb</li></ul><h2 id="设计"><a href="#设计" class="headerlink" title="设计"></a>设计</h2><h3 id="架构"><a href="#架构" class="headerlink" title="架构"></a>架构</h3><p><img src="https://user-images.githubusercontent.com/27911304/82168048-3e1ecb80-98f0-11ea-8f64-e8592e97f03f.png" srcset="/img/loading.gif" lazyload alt="系统架构"></p><p><img src="https://user-images.githubusercontent.com/27911304/82168151-a53c8000-98f0-11ea-98d6-7307b519efd5.png" srcset="/img/loading.gif" lazyload alt="流程图"></p><h4 id="client"><a href="#client" class="headerlink" title="client"></a>client</h4><p>供日志产生端使用的工具模块。思路为自定义日志组件消息通道，目前支持log4j框架；以及直接读入程序日志文件。该模块需要对现有Java项目进行一定程序的修改。</p><h4 id="MQ"><a href="#MQ" class="headerlink" title="MQ"></a>MQ</h4><p>消息中间件依赖。用于中转日志以及服务状态监控等数据通信领域。</p><h4 id="Server"><a href="#Server" class="headerlink" title="Server"></a>Server</h4><p>日志采集模块。负责监听消息中间件，将日志消息持久化到TSDB，同时负责按照一定的周期备份日志文件到本地文件系统或其他存储系统。</p><p>该模块支持横向扩展，只需要多台机器保持消息中间件等相关配置一致即可。</p><h4 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h4><p>图形化界面模块。B/S架构。该模块以Web界面方式提供监控Server模块状态、日志文件下载、系统报警和实时日志浏览等功能。</p><p>该模块非必需模块，缺失或宕机不影响日志采集存储功能。</p><h4 id="TSDB"><a href="#TSDB" class="headerlink" title="TSDB"></a>TSDB</h4><p>时序数据库。用于临时存储日志消息，以解决使用消息中间件通讯中由于网络抖动等原因导致的顺序错位。</p><h3 id="通信方案"><a href="#通信方案" class="headerlink" title="通信方案"></a>通信方案</h3><p>本系统使用了四种通信方式</p><ul><li>JMS——主要用于Client-MQ-Server。</li><li>HTTP协议——Web模块对用户提供服务。</li><li>Socket——Web和Server直接通信，主要用于文件传输。</li><li>WebSocket——用于Web模块浏览实时日志</li></ul><p><img src="https://user-images.githubusercontent.com/27911304/82168320-1b40e700-98f1-11ea-9cc6-952fe013ae38.png" srcset="/img/loading.gif" lazyload alt="client-MQ-Server"></p><p><img src="https://user-images.githubusercontent.com/27911304/82168325-209e3180-98f1-11ea-906d-1a36e6e15e95.png" srcset="/img/loading.gif" lazyload alt="Web-User"></p><p><img src="https://user-images.githubusercontent.com/27911304/82168332-23992200-98f1-11ea-8afd-105f03851967.png" srcset="/img/loading.gif" lazyload alt="Client-Web"></p><h2 id="可行性分析"><a href="#可行性分析" class="headerlink" title="可行性分析"></a>可行性分析</h2><p>解释部分设计原理和难点解决方案</p><h3 id="日志发送方式"><a href="#日志发送方式" class="headerlink" title="日志发送方式"></a>日志发送方式</h3><p>引入消息中间件作为通信桥梁，使用队列模式</p><p><strong>优点</strong></p><ul><li>日志生产者和消费者解耦</li><li>日志消费者可以横向扩展</li></ul><p><strong>缺点</strong></p><ul><li>日志消费者无法保证日志有序</li></ul><h3 id="Java程序如何接入"><a href="#Java程序如何接入" class="headerlink" title="Java程序如何接入"></a>Java程序如何接入</h3><ul><li>如果是基于slf4j的程序，只需要引入一个appender，修改日志配置即可</li><li>或者基于文件监控，需要在服务器上额外部署一个服务(不推荐)</li></ul><h3 id="如何保证日志有序"><a href="#如何保证日志有序" class="headerlink" title="如何保证日志有序"></a>如何保证日志有序</h3><p>引入时序数据库，日志消费者将从中间件获取的日志存储到时序数据库，由时序数据库负责排序和临时存储。消费者再每隔一段时间从数据库获取数据，依次保证在这段时间间隔内的日志尽可能有序。</p><h3 id="如何实现日志实时浏览"><a href="#如何实现日志实时浏览" class="headerlink" title="如何实现日志实时浏览"></a>如何实现日志实时浏览</h3><ul><li>日志消费者在从<strong>queue</strong>中获取数据后，再以<strong>topic</strong>形式发送出去</li><li>Web模块订阅<strong>topic</strong>，一旦接收到日志消息，则以<strong>WebSocket</strong>方式进行广播</li><li>前端通过<strong>WebSocket</strong>和后端进行全双工通信</li></ul><h3 id="如何降低耦合"><a href="#如何降低耦合" class="headerlink" title="如何降低耦合"></a>如何降低耦合</h3><p><strong>耦合来源</strong></p><ul><li>消息中间件</li><li>时序数据库</li></ul><p><strong>解决方案</strong></p><p>使用设计模式实现相关实现的可替换。可参考slf4j不同日志输出组件的原理</p><h2 id="健壮性分析"><a href="#健壮性分析" class="headerlink" title="健壮性分析"></a>健壮性分析</h2><ul><li>消息中间件</li></ul><p>消息中间件宕机将会影响Client发送日志，此时Client需要将日志缓存到本地，等待消息中间件恢复之后将日志消息重新发送。</p><ul><li>Client</li></ul><p>Client宕机即代表终端服务宕机，此时不会产生日志，且终端服务宕机应该有另外的报警方案，不在本系统设计考虑范围内。</p><ul><li>Server</li></ul><p>Server支持横向扩展，单一机器宕机只会影响日志采集效率，不会导致系统全线崩溃。</p><ul><li>Web</li></ul><p>该模块为非必需模块，宕机不会影响日志采集功能，因此不在考虑范围内；建议使用额外的方案以监听该模块状态，例如定时发送HTTP请求即可判断模块运行状态。</p><ul><li>TSDB</li></ul><p>时序数据库宕机将会导致Server无法持久化，此时Server将会把采集到的日志返还到消息中间件，不采用缓存方案，防止此时Server宕机导致缓存的日志丢失。</p><h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><h3 id="数据库设计"><a href="#数据库设计" class="headerlink" title="数据库设计"></a>数据库设计</h3><p><img src="https://user-images.githubusercontent.com/27911304/82169128-10875180-98f3-11ea-8ffd-bd0d51e46702.png" srcset="/img/loading.gif" lazyload alt="Web模块"></p><p><img src="https://user-images.githubusercontent.com/27911304/82169134-154c0580-98f3-11ea-9b97-7683a33f216d.png" srcset="/img/loading.gif" lazyload alt="Server模块"></p><p><img src="https://user-images.githubusercontent.com/27911304/82169137-167d3280-98f3-11ea-8c6a-58779faeb1ea.png" srcset="/img/loading.gif" lazyload alt="时序数据库"></p><h3 id="源码"><a href="#源码" class="headerlink" title="源码"></a>源码</h3><p>本系统已托管在<strong>github</strong>，项目地址为：<a target="_blank" rel="noopener" href="https://github.com/inkroom/log-colleage/">https://github.com/inkroom/log-colleage/</a></p></div><hr><div><div class="post-metas my-3"><div class="post-meta mr-3 d-flex align-items-center"><i class="iconfont icon-category"></i> <span class="category-chains"><span class="category-chain"><a href="/categories/%E5%90%8E%E7%AB%AF/" class="category-chain-item">后端</a> <span>></span> <a href="/categories/%E5%90%8E%E7%AB%AF/java/" class="category-chain-item">java</a></span></span></div><div class="post-meta"><i class="iconfont icon-tags"></i> <a href="/tags/java/" class="print-no-link">#java</a> <a href="/tags/%E5%90%8E%E7%AB%AF/" class="print-no-link">#后端</a> <a href="/tags/log/" class="print-no-link">#log</a> <a href="/tags/%E6%97%A5%E5%BF%97%E9%87%87%E9%9B%86/" class="print-no-link">#日志采集</a></div></div><div class="license-box my-3"><div class="license-title"><div>日志采集</div><div>http://blog.inkroom.cn/2020/05/18/126CEWS.html</div></div><div class="license-meta"><div class="license-meta-item"><div>作者</div><div>inkbox</div></div><div class="license-meta-item license-meta-date"><div>发布于</div><div>2020年5月18日</div></div><div class="license-meta-item"><div>许可协议</div><div><a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/"><span class="hint--top hint--rounded" aria-label="BY - 署名"><i class="iconfont icon-cc-by"></i></span></a></div></div></div><div class="license-icon iconfont"></div></div><div class="post-prevnext my-3"><article class="post-prev col-6"><a href="/2020/05/28/3NZ0KXT.html" title="数组越界下标翻转"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">数组越界下标翻转</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/dream.html" title="dream"><span class="hidden-mobile">dream</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="side-col d-none d-lg-block col-lg-2"></div></div></div><a id="scroll-top-button" aria-label="TOP" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer><div class="footer-inner"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div></div></footer><script src="https://cdn.bootcdn.net/ajax/libs/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:100}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.6.4/jquery.min.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.6.1/js/bootstrap.min.js"></script><script src="/js/events.js"></script><script src="/js/plugins.js"></script><script src="https://cdn.bootcdn.net/ajax/libs/typed.js/2.0.12/typed.min.js"></script><script>!function(t,e){var i=Fluid.plugins.typing,n=e.getElementById("subtitle");n&&i&&i(n.getAttribute("data-typed-text"))}(window,document)</script><script src="/js/img-lazyload.js"></script><script>Fluid.utils.createScript("https://cdn.bootcdn.net/ajax/libs/tocbot/4.20.1/tocbot.min.js",(function(){var t=jQuery("#toc");if(0!==t.length&&window.tocbot){var o=jQuery("#board-ctn").offset().top;window.tocbot.init(Object.assign({tocSelector:"#toc-body",contentSelector:".markdown-body",linkClass:"tocbot-link",activeLinkClass:"tocbot-active-link",listClass:"tocbot-list",isCollapsedClass:"tocbot-is-collapsed",collapsibleClass:"tocbot-is-collapsible",scrollSmooth:!0,includeTitleTags:!0,headingsOffset:-o},CONFIG.toc)),t.find(".toc-list-item").length>0&&t.css("visibility","visible"),Fluid.events.registerRefreshCallback((function(){if("tocbot"in window){tocbot.refresh();var t=jQuery("#toc");if(0===t.length||!tocbot)return;t.find(".toc-list-item").length>0&&t.css("visibility","visible")}}))}}))</script><script src="https://cdn.bootcdn.net/ajax/libs/clipboard.js/2.0.11/clipboard.min.js"></script><script>Fluid.plugins.codeWidget()</script><script>Fluid.utils.createScript("https://cdn.bootcdn.net/ajax/libs/anchor-js/4.3.1/anchor.min.js",(function(){window.anchors.options={placement:CONFIG.anchorjs.placement,visible:CONFIG.anchorjs.visible},CONFIG.anchorjs.icon&&(window.anchors.options.icon=CONFIG.anchorjs.icon);var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(window.anchors.options.class="anchorjs-link-left"),window.anchors.add(o.join(", ")),Fluid.events.registerRefreshCallback((function(){if("anchors"in window){anchors.removeAll();var n=(CONFIG.anchorjs.element||"h1,h2,h3,h4,h5,h6").split(","),o=[];for(var s of n)o.push(".markdown-body > "+s.trim());"left"===CONFIG.anchorjs.placement&&(anchors.options.class="anchorjs-link-left"),anchors.add(o.join(", "))}}))}))</script><script>Fluid.utils.createScript("https://cdn.bootcdn.net/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js",(function(){Fluid.plugins.fancyBox()}))</script><script>Fluid.plugins.imageCaption()</script><script src="/js/local-search.js"></script><script src="/js/boot.js"></script><noscript><div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div></noscript></body></html>