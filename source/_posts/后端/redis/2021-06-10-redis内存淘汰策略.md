---
title: redis内存淘汰策略
date: 2021-06-10 17:45:32
tags: [后端,redis]
---

关于redis的内存淘汰策略的笔记


<!-- more -->

### 可以使用多大内存

redis通过以下配置决定内存使用量

```redis
maxmemory 100mb
```

可以在配置文件中注明，也可以在运行时通过`config`命令指定

如果设置为**0**，在64位系统上是无限制，就是可以使用所有的物理内存，在32位系统上最多使用3GB



### 什么时候淘汰内存

redis遵循以下逻辑

- 客户端发送一个命令，该命令会导致内存占用增加
- redis检查当前剩余内存是否够执行该命令，如果不够，则执行淘汰策略
- redis执行命令，返回结果

### 有哪些淘汰策略

在4.0以后的版本中，有以下策略

- **noeviction**: 可能导致内存增加的命令直接返回错误，所以不包括**del**和一些其他命令
- **allkeys-lru**: 按照最近最少使用算法淘汰，淘汰范围为所有的key
- **volatile-lru**: 按照最近最少使用算法淘汰，淘汰范围为设置了过期时间的key
- **allkeys-random**: 随机淘汰，淘汰范围为所有的key
- **volatile-random**: 随机淘汰，淘汰范围为设置了过期时间的key
- **volatile-ttl**: 淘汰ttl最短的key
- **volatile-lfu**: 按照最少访问频率淘汰，淘汰范围为设置了过期时间的key
- **allkeys-lfu**: 按照最少访问频率淘汰，淘汰范围为所有的key


可以按照以下方式记忆：

redis淘汰策略有：**不淘汰**、**最近最少使用(lru)**、**随机淘汰**、**最短过期时间(ttl)**、**最少访问频率(lfu)**。

除了**不淘汰**和**ttl**，剩下的又有两种分类，**所有的key**(allkeys)、**有过期时间的key**(volatile)

---

其中**noeviction**是默认的淘汰策略，同时如果其他淘汰策略无法淘汰合适的内存大小，也会进入该模式

### 如何选择淘汰策略

如果你不知道怎么选，直接使用**allkeys-lru**。这是官方推荐的策略（This is a good pick if you are unsure）。

- 如果所有的key都有一个周期性的访问，