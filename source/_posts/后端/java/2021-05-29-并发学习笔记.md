---
title: 并发学习笔记
date: 2021-05-29 15:59:11
tags: [java, 并发]
---

并发学习笔记

<!-- more -->


### Volatile

两种功能：

- 禁止volatile变量本身的读写 和前后的操作之间的重排序
- 保证写入volatile会更新线程共享变量到主内存中（类似于缓存落库）；保证读取volatile之前会从主内存获取共享变量（类似与缓存更新）



---

有以下程序

```java

static boolean f = true;
public void static main(String[] args){
    
    new Threan(new Runable(){
        public void run(){
            while(r){}
            System.out.println('结束循环');
        }
    }).start();
     try {
         Thread.sleep(1000);
     } catch (InterruptedException e) {
         e.printStackTrace();
     }
    s = false;
    
}

```

由于**jmm**不保证 **f** 的内存可见性，死循环将永远无法结束

想要结束有以下方法

- 给**f** 加上**volatile** 关键字
- 此外 **f** 不变，额外加上一个 **volatile** 的变量 **a**，在循环体内读变量**a**进行读或者写操作，也能结束循环
- 循环体内执行一个有**synchronized**关键字的方法

---

以上方法的原理是强制线程从主内存里获取共享变量最新的值



